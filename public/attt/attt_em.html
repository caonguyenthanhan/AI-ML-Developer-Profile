<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫©m nang An to√†n Th√¥ng tin (T·ªïng h·ª£p 21 ch·ªß ƒë·ªÅ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="/image/Security Icon.png">
    <style>
        html { scroll-behavior: smooth; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; visibility: hidden; opacity: 0; }
        .accordion-content.open { max-height: 10000px; visibility: visible; opacity: 1; transition: max-height 0.8s ease-in, opacity 0.3s ease-in 0.1s; }
        .quiz-option { transition: all 0.2s ease-in-out; }
        .quiz-option.correct { background-color: #dcfce7; border-color: #22c55e; color: #166534; }
        .quiz-option.incorrect { background-color: #fee2e2; border-color: #ef4444; color: #991b1b; opacity: 0.7; }
        .quiz-option:disabled { cursor: not-allowed; }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dataUrl = 'https://hethongthongminh.id.vn/data/Handbook_Data_ATTT.json';
            const sectionMap = {
                'T·∫•n c√¥ng & L·ªó h·ªïng': 'section-1',
                'C√¥ng c·ª•': 'section-1',
                'M·∫≠t m√£ h·ªçc': 'section-2',
                'H·∫° t·∫ßng': 'section-3',
                'H·∫° t·∫ßng & Giao th·ª©c': 'section-3'
            };

            const s1 = document.getElementById('section-1-items');
            const s2 = document.getElementById('section-2-items');
            const s3 = document.getElementById('section-3-items');

            const quizDatabase = {};

            function renderFromJson(json) {
                const topics = (json && json.topics) ? json.topics : [];
                topics.forEach(topic => {
                    const secId = sectionMap[topic.category] || 'section-1';
                    const container = secId === 'section-1' ? s1 : secId === 'section-2' ? s2 : s3;
                    const item = buildTopicItem(topic);
                    container.appendChild(item);
                    quizDatabase[topic.id] = topic.quiz || [];
                });
                initAccordion();
                bindStartQuizButtons(quizDatabase);
            }

            fetch(encodeURI(dataUrl))
                .then(r => r.json())
                .then(json => { renderFromJson(json); })
                .catch(() => {
                    const fb = document.getElementById('json-fallback');
                    if (fb) fb.classList.remove('hidden');
                });

            function buildTopicItem(topic) {
                const item = document.createElement('div');
                item.className = 'accordion-item bg-white rounded-xl shadow border border-slate-200 overflow-hidden group';
                const header = document.createElement('button');
                header.className = 'accordion-header w-full text-left p-6 text-xl font-bold text-indigo-900 hover:bg-indigo-50 transition-all duration-200 flex justify-between items-center';
                header.innerHTML = `<span>${topic.title}</span><span class="arrow text-indigo-300 transform transition-transform duration-300 text-2xl">&#9662;</span>`;
                const content = document.createElement('div');
                content.className = 'accordion-content bg-slate-50';
                const inner = document.createElement('div');
                inner.className = 'p-6 sm:p-8 border-t border-slate-200';
                const summary = document.createElement('p');
                summary.className = 'text-slate-700 mb-4';
                summary.textContent = (topic.content && topic.content.summary) ? topic.content.summary : '';
                inner.appendChild(summary);
                const details = (topic.content && topic.content.details) ? topic.content.details : [];
                details.forEach(d => {
                    const block = document.createElement('div');
                    block.className = 'mb-4';
                    const h = document.createElement('h3');
                    h.className = 'text-lg font-bold text-indigo-700 mb-2';
                    h.textContent = d.heading || '';
                    const t = document.createElement('p');
                    t.className = 'text-slate-700';
                    t.textContent = d.text || '';
                    block.appendChild(h);
                    block.appendChild(t);
                    inner.appendChild(block);
                });
                const quizBtnWrap = document.createElement('div');
                quizBtnWrap.className = 'text-center mt-6 pt-6 border-t border-slate-200';
                const quizBtn = document.createElement('button');
                quizBtn.className = 'start-quiz-btn bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg';
                quizBtn.dataset.topic = topic.id;
                quizBtn.textContent = `Luy·ªán t·∫≠p ${topic.title}`;
                quizBtnWrap.appendChild(quizBtn);
                inner.appendChild(quizBtnWrap);
                content.appendChild(inner);
                item.appendChild(header);
                item.appendChild(content);
                return item;
            }

            function initAccordion() {
                const headers = document.querySelectorAll('.accordion-header');
                headers.forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        const arrow = header.querySelector('.arrow');
                        const isOpen = content.classList.contains('open');
                        if (isOpen) { content.classList.remove('open'); if (arrow) arrow.style.transform = 'rotate(0deg)'; }
                        else { content.classList.add('open'); if (arrow) arrow.style.transform = 'rotate(180deg)'; }
                    });
                });
            }

            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuBtn && mobileMenu) mobileMenuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

            const QUIZ_SESSION_LENGTH = 10;
            let currentQuizPool = [];
            let currentQuestionIndex = 0;
            let score = 0;
            let wrongTries = 0;
            let currentTopicKey = '';

            const modal = document.getElementById('quiz-modal');
            const questionText = document.getElementById('question-text');
            const answerOptions = document.getElementById('answer-options');
            const feedbackArea = document.getElementById('feedback-area');
            const nextBtn = document.getElementById('next-question-btn');
            const scoreDisplay = document.getElementById('score-display');
            const questionCounter = document.getElementById('question-counter');
            const quizContent = document.getElementById('quiz-content');
            const quizResults = document.getElementById('quiz-results');
            const finalScore = document.getElementById('final-score');

            function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

            function buildQuizPool(list) {
                const arr = shuffle([...list]);
                if (arr.length >= QUIZ_SESSION_LENGTH) return arr.slice(0, QUIZ_SESSION_LENGTH);
                const pool = [...arr];
                if (arr.length > 0) {
                    while (pool.length < QUIZ_SESSION_LENGTH) pool.push(arr[Math.floor(Math.random() * arr.length)]);
                }
                return pool;
            }

            function bindStartQuizButtons(quizDB) {
                document.querySelectorAll('.start-quiz-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const topic = e.currentTarget.dataset.topic;
                        const allQuestions = quizDB[topic];
                        if (!allQuestions || allQuestions.length === 0) { alert('D·ªØ li·ªáu ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t!'); return; }
                        currentTopicKey = topic; score = 0; currentQuestionIndex = 0;
                        currentQuizPool = buildQuizPool(allQuestions);
                        updateUI(); modal.classList.remove('hidden'); showResults(false); loadQuestion();
                    });
                });
            }

            function loadQuestion() {
                const q = currentQuizPool[currentQuestionIndex];
                if (!q) return;
                questionText.innerText = q.q;
                questionCounter.innerText = `${currentQuestionIndex + 1} / ${currentQuizPool.length}`;
                feedbackArea.classList.add('hidden'); nextBtn.classList.add('hidden'); wrongTries = 0;
                const correctOpts = q.options.filter(o => o.correct);
                const incorrectOpts = q.options.filter(o => !o.correct);
                const chosenCorrect = shuffle(correctOpts)[0];
                const chosenIncorrect = shuffle(incorrectOpts).slice(0, 3);
                const displayOpts = shuffle([chosenCorrect, ...chosenIncorrect]);
                answerOptions.innerHTML = '';
                displayOpts.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'quiz-option w-full text-left p-4 rounded-lg border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 font-medium text-slate-700 transition-all';
                    btn.innerText = opt.text;
                    btn.onclick = () => handleAnswer(btn, opt.correct, q.explanation, chosenCorrect.text);
                    answerOptions.appendChild(btn);
                });
            }

            function handleAnswer(btn, isCorrect, explanation, correctText) {
                const allBtns = answerOptions.querySelectorAll('button');
                if (isCorrect) {
                    btn.classList.add('correct', 'border-green-500', 'bg-green-50', 'text-green-800');
                    if (wrongTries === 0) score += 1;
                    showFeedback(true, explanation);
                    allBtns.forEach(b => b.disabled = true);
                    nextBtn.classList.remove('hidden');
                    updateUI();
                } else {
                    btn.classList.add('incorrect', 'border-red-300', 'bg-red-50');
                    btn.disabled = true; score -= 0.5; wrongTries++; updateUI();
                    if (wrongTries >= 3) {
                        showFeedback(false, `ƒê√°p √°n ƒë√∫ng: "${correctText}". <br><br>${explanation}`);
                        allBtns.forEach(b => { b.disabled = true; if (b.innerText === correctText) b.classList.add('correct', 'border-green-500'); });
                        nextBtn.classList.remove('hidden');
                    }
                }
            }

            function showFeedback(success, text) {
                feedbackArea.classList.remove('hidden');
                feedbackArea.className = `mt-6 p-4 rounded-lg text-sm border ${success ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'} animate-fade-in`;
                feedbackArea.innerHTML = `<strong>${success ? 'Ch√≠nh x√°c!' : 'Sai qu√° 3 l·∫ßn!'}</strong> ${text}`;
            }

            function updateUI() { scoreDisplay.innerText = score; scoreDisplay.className = score < 0 ? 'text-lg font-bold text-red-600' : 'text-lg font-bold text-green-600'; }
            if (nextBtn) nextBtn.onclick = () => { currentQuestionIndex++; if (currentQuestionIndex < currentQuizPool.length) loadQuestion(); else finishQuiz(); };
            function finishQuiz() { showResults(true); finalScore.innerText = score; }
            function showResults(show) { if (show) { quizContent.classList.add('hidden'); quizResults.classList.remove('hidden'); nextBtn.classList.add('hidden'); } else { quizContent.classList.remove('hidden'); quizResults.classList.add('hidden'); } }
            const closeBtn = document.getElementById('close-quiz-btn');
            if (closeBtn) closeBtn.onclick = () => modal.classList.add('hidden');
            const restartBtn = document.getElementById('restart-quiz-btn');
            if (restartBtn) restartBtn.onclick = () => {
                const trigger = document.querySelector(`button[data-topic="${currentTopicKey}"]`);
                if (trigger) trigger.click();
            };

            const fileInput = document.getElementById('json-file-input');
            if (fileInput) fileInput.addEventListener('change', (e) => {
                const file = e.target.files && e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = () => {
                    try {
                        const json = JSON.parse(reader.result);
                        renderFromJson(json);
                        const fb = document.getElementById('json-fallback');
                        if (fb) fb.classList.add('hidden');
                    } catch {
                        alert('T·ªáp JSON kh√¥ng h·ª£p l·ªá');
                    }
                };
                reader.readAsText(file);
            });
        });
    </script>
</head>
<body class="bg-slate-100 text-slate-800 font-sans leading-relaxed">
    <nav class="bg-indigo-900 text-white shadow-lg sticky top-0 z-50 border-b border-indigo-800">
        <div class="container mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0 flex items-center gap-2">
                    <span class="text-2xl">üõ°Ô∏è</span>
                    <h1 class="text-xl sm:text-2xl font-bold tracking-tight">INSE Handbook <span class="text-green-400 text-sm font-normal">D·ªØ li·ªáu ƒë·ªông</span></h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#section-1" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 transition-colors">T·∫•n c√¥ng & L·ªó h·ªïng</a>
                        <a href="#section-2" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 transition-colors">M·∫≠t m√£ h·ªçc</a>
                        <a href="#section-3" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 transition-colors">H·∫° t·∫ßng & Giao th·ª©c</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-indigo-200 hover:text-white focus:outline-none">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden bg-indigo-900">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#section-1" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-indigo-700">Ph·∫ßn 1</a>
                <a href="#section-2" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-indigo-700">Ph·∫ßn 2</a>
                <a href="#section-3" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-indigo-700">Ph·∫ßn 3</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto max-w-5xl p-4 sm:p-6 lg:p-8">
        <div class="bg-white rounded-xl shadow-md p-6 sm:p-8 mb-10 border-l-4 border-indigo-500">
            <h2 class="text-2xl font-bold text-indigo-900 mb-3">B·∫£n T·ªïng H·ª£p d·ªØ li·ªáu ƒë·ªông</h2>
            <p class="text-slate-600">N·ªôi dung, chi ti·∫øt v√† c√¢u h·ªèi ƒë∆∞·ª£c n·∫°p t·ª´: <code class="bg-indigo-50 text-indigo-700 px-2 py-1 rounded">https://hethongthongminh.id.vn/data/Handbook_Data_ATTT.json</code>.</p>
        </div>

        <section id="section-1" class="mb-16">
            <div class="flex items-center mb-6 border-b-2 border-indigo-200 pb-2">
                <span class="text-4xl mr-3">‚öîÔ∏è</span>
                <h2 class="text-3xl font-bold text-slate-800">Ph·∫ßn 1: T·∫•n c√¥ng, L·ªó h·ªïng & C√¥ng c·ª•</h2>
            </div>
            <div id="section-1-items" class="space-y-4"></div>
        </section>

        <section id="section-2" class="mb-16">
            <div class="flex items-center mb-6 border-b-2 border-indigo-200 pb-2">
                <span class="text-4xl mr-3">üîê</span>
                <h2 class="text-3xl font-bold text-slate-800">Ph·∫ßn 2: M·∫≠t m√£ h·ªçc (Cryptography)</h2>
            </div>
            <div id="section-2-items" class="space-y-4"></div>
        </section>

        <section id="section-3" class="mb-16">
            <div class="flex items-center mb-6 border-b-2 border-indigo-200 pb-2">
                <span class="text-4xl mr-3">üîó</span>
                <h2 class="text-3xl font-bold text-slate-800">Ph·∫ßn 3: H·∫° t·∫ßng & Giao th·ª©c</h2>
            </div>
            <div id="section-3-items" class="space-y-4"></div>
        </section>
    </main>

    <div id="json-fallback" class="hidden fixed bottom-4 right-4 bg-yellow-50 border border-yellow-200 p-4 rounded-xl shadow-lg z-40 w-[320px]">
        <div class="flex items-start gap-3">
            <div class="text-yellow-500">‚ö†Ô∏è</div>
            <div class="flex-1">
                <div class="font-bold text-yellow-900">Kh√¥ng t·∫£i ƒë∆∞·ª£c JSON qua fetch</div>
                <div class="text-sm text-yellow-800 mt-1">Ch·ªçn t·ªáp JSON th·ªß c√¥ng ƒë·ªÉ n·∫°p d·ªØ li·ªáu.</div>
                <input id="json-file-input" type="file" accept="application/json" class="mt-3 w-full text-sm" />
            </div>
        </div>
    </div>

    <div id="quiz-modal" class="fixed inset-0 bg-indigo-900 bg-opacity-80 backdrop-blur-sm flex items-center justify-center p-0 sm:p-4 z-50 hidden">
        <div id="quiz-container" class="bg-white sm:rounded-2xl shadow-2xl w-full max-w-3xl h-full sm:h-auto sm:max-h-[90vh] flex flex-col overflow-hidden">
            <header class="p-5 bg-indigo-600 text-white flex justify-between items-center shadow-md">
                <div><h2 id="quiz-title" class="text-xl font-bold">Luy·ªán t·∫≠p</h2><p class="text-indigo-100 text-xs mt-1">Ch·∫ø ƒë·ªô: 10 c√¢u ng·∫´u nhi√™n</p></div>
                <button id="close-quiz-btn" class="text-indigo-200 hover:text-white transition-colors bg-indigo-700 hover:bg-indigo-500 rounded-full p-2"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </header>
            <div class="p-6 sm:p-8 flex-grow overflow-y-auto bg-slate-50">
                <div class="flex justify-between items-center mb-6 bg-white p-3 rounded-lg shadow-sm border border-slate-200">
                    <div class="flex items-center gap-2"><span class="text-xs font-bold uppercase text-slate-400 tracking-wide">Ti·∫øn ƒë·ªô</span><span id="question-counter" class="text-lg font-bold text-indigo-600">1 / 10</span></div>
                    <div class="flex items-center gap-2"><span class="text-xs font-bold uppercase text-slate-400 tracking-wide">ƒêi·ªÉm s·ªë</span><span id="score-display" class="text-lg font-bold text-green-600">0</span></div>
                </div>
                <div id="quiz-content"><div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-6 relative"><span class="absolute top-0 left-0 bg-indigo-100 text-indigo-800 text-xs font-bold px-3 py-1 rounded-br-xl">C√¢u h·ªèi</span><p id="question-text" class="text-xl font-medium text-slate-800 mt-4 leading-relaxed">N·ªôi dung c√¢u h·ªèi...</p></div><div id="answer-options" class="grid grid-cols-1 gap-3"></div><div id="feedback-area" class="hidden mt-6"></div></div>
                <div id="quiz-results" class="hidden text-center py-10"><div class="inline-block p-4 rounded-full bg-indigo-100 text-indigo-600 mb-4"><svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><h3 class="text-3xl font-bold text-slate-800 mb-2">Ho√†n th√†nh!</h3><p class="text-slate-500 mb-6">B·∫°n ƒë√£ ho√†n th√†nh b√†i ki·ªÉm tra.</p><div class="text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-8" id="final-score">0</div><button id="restart-quiz-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-all shadow-lg hover:shadow-indigo-200 transform hover:-translate-y-1">L√†m l·∫°i ch·ªß ƒë·ªÅ n√†y</button></div>
            </div>
            <footer class="p-4 bg-white border-t border-slate-200 flex justify-end h-20 items-center"><button id="next-question-btn" class="hidden bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors flex items-center">C√¢u ti·∫øp theo <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></button></footer>
        </div>
    </div>
</body>
</html>