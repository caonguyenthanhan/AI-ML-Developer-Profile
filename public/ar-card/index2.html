<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Electrical Engineer Graduation - AR Sync</title>

  <!-- A-Frame & MindAR -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

  <style>
    /* --- C·∫§U H√åNH C∆† B·∫¢N --- */
    body { 
      margin: 0; 
      background: #000; 
      overflow: hidden; 
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
    }
    
    * { user-select: none; -webkit-user-select: none; }

    /* M√†n h√¨nh ch·ªù */
    #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
    .btn-start {
      padding: 15px 30px; font-size: 18px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
      background: linear-gradient(135deg, #00C6FF, #0072FF);
      color: white; border: none; border-radius: 50px; cursor: pointer; 
      box-shadow: 0 0 20px rgba(0, 114, 255, 0.6);
      animation: pulse 2s infinite;
    }

    /* --- AR HTML CARD (DYNAMIC) --- */
    #ar-card-content {
      position: absolute;
      top: 0; left: 0;
      width: 280px; /* Chi·ªÅu r·ªông th·∫ª */
      
      transform-origin: center center;
      
      background: rgba(20, 20, 35, 0.95); /* N·ªÅn t·ªëi ƒë·∫≠m h∆°n ƒë·ªÉ n·ªïi b·∫≠t ·∫£nh */
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      
      /* Vi·ªÅn Gradient gi·∫£ l·∫≠p m√†u kim lo·∫°i */
      border: 2px solid transparent;
      background-image: linear-gradient(rgba(20, 20, 35, 0.95), rgba(20, 20, 35, 0.95)), linear-gradient(to right, #00C6FF, #FFD700);
      background-origin: border-box;
      background-clip: content-box, border-box;
      
      border-radius: 12px;
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8);
      
      padding: 12px;
      text-align: center;
      color: white;
      
      opacity: 0;
      pointer-events: none;
      z-index: 1000;
      will-change: transform, opacity;
      
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* Header: T√™n & Danh hi·ªáu */
    .card-header {
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding-bottom: 8px;
    }
    .card-header h1 { 
      margin: 0; font-size: 14px; 
      color: #00C6FF; /* M√†u xanh Cyan ch·ªß ƒë·∫°o */
      text-transform: uppercase; letter-spacing: 1.5px; font-weight: 700;
    }
    .card-header h2 { 
      margin: 4px 0 0; font-size: 16px; 
      color: #FFD700; /* M√†u v√†ng Gold cho t√™n */
      font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    /* Slideshow */
    .slideshow-container {
      position: relative; width: 100%; aspect-ratio: 3/4; /* T·ªâ l·ªá ·∫£nh ch√¢n dung */
      overflow: hidden; border-radius: 6px; 
      border: 1px solid rgba(255,255,255,0.2);
      background: #000;
    }
    .slide-img {
      width: 100%; height: 100%; object-fit: cover;
      position: absolute; top: 0; left: 0;
      opacity: 0; transition: opacity 0.8s ease;
    }
    .slide-img.active { opacity: 1; }

    /* Hi·ªáu ·ª©ng ch·∫°y ch·ªØ (Marquee) */
    .marquee-wrapper {
      width: 100%;
      overflow: hidden;
      background: rgba(0, 198, 255, 0.1); /* N·ªÅn xanh nh·∫°t */
      border-radius: 4px;
      padding: 6px 0;
      border: 1px solid rgba(0, 198, 255, 0.3);
    }
    .marquee-content {
      display: inline-block;
      white-space: nowrap;
      animation: marquee 12s linear infinite;
      font-size: 12px;
      font-weight: 600;
      color: #fff;
    }
    .marquee-content span {
      margin-right: 40px; /* Kho·∫£ng c√°ch gi·ªØa c√°c c√¢u l·∫∑p l·∫°i */
    }

    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    
    /* Filmstrip ·ªü d∆∞·ªõi */
    #filmstrip-container {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 80px;
      background: linear-gradient(to top, rgba(0,0,0,1), transparent);
      z-index: 900; opacity: 0; transition: opacity 0.5s; pointer-events: none;
      display: flex; align-items: center; justify-content: center;
    }
    #filmstrip-container.visible { opacity: 1; }
    
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
  </style>

  <script>
    /* --- COMPONENT: HTML FOLLOWER (Gi·ªØ nguy√™n logic di chuy·ªÉn) --- */
    AFRAME.registerComponent('html-follower', {
      schema: {
        target: {type: 'selector'},
        minScale: {default: 0.6},
        maxScale: {default: 1.4}
      },
      init: function() {
        this.htmlEl = this.data.target;
        this.vector = new THREE.Vector3();
        this.camera = document.querySelector('a-camera').object3D;
        this.isVisible = false;
      },
      tick: function() {
        if (!this.el.object3D.visible) {
          if (this.isVisible) {
            this.htmlEl.style.opacity = 0;
            this.isVisible = false;
          }
          return;
        }

        this.el.object3D.getWorldPosition(this.vector);
        this.vector.project(this.el.sceneEl.camera);

        const x = this.vector.x;
        const y = this.vector.y;
        const z = this.vector.z;

        const width = window.innerWidth;
        const height = window.innerHeight;
        
        const screenX = (x * 0.5 + 0.5) * width;
        const screenY = -(y * 0.5 - 0.5) * height;

        const distance = this.el.object3D.position.distanceTo(this.camera.position);
        
        let scaleFactor = 1.8 / distance; 
        scaleFactor = Math.min(Math.max(scaleFactor, this.data.minScale), this.data.maxScale);

        if (z < 1 && x > -1.2 && x < 1.2 && y > -1.2 && y < 1.2) {
            this.htmlEl.style.transform = `translate3d(${screenX}px, ${screenY}px, 0) translate(-50%, -50%) scale(${scaleFactor})`;
            
            if (!this.isVisible) {
                this.htmlEl.style.opacity = 1;
                this.isVisible = true;
            }
        } else {
            if (this.isVisible) {
                this.htmlEl.style.opacity = 0;
                this.isVisible = false;
            }
        }
      }
    });

    // --- APP MANAGER ---
    AFRAME.registerComponent('app-manager', {
      init: function() {
        const btn = document.querySelector('.btn-start');
        const overlay = document.getElementById('overlay');
        const audio = document.getElementById('bg-music');
        const filmstrip = document.getElementById('filmstrip-container');
        
        // Slideshow logic
        let slideIndex = 0;
        const showSlides = () => {
          const slides = document.querySelectorAll('.slide-img');
          if(!slides.length) return;
          slides.forEach(s => s.classList.remove('active'));
          slideIndex = (slideIndex + 1) % slides.length;
          slides[slideIndex].classList.add('active');
        };
        setInterval(showSlides, 3000); // 3 gi√¢y ƒë·ªïi ·∫£nh

        btn.onclick = () => {
          overlay.style.opacity = 0;
          setTimeout(() => overlay.remove(), 500);
          audio.play().catch(()=>{});
        };

        const target = document.querySelector('[mindar-image-target]');
        target.addEventListener('targetFound', () => {
          filmstrip.classList.add('visible');
          audio.play().catch(()=>{});
        });
        target.addEventListener('targetLost', () => {
          filmstrip.classList.remove('visible');
          audio.pause();
        });
      }
    });
  </script>
</head>

<body>

  <div id="overlay">
    <button class="btn-start">B·∫Øt ƒê·∫ßu Tr·∫£i Nghi·ªám</button>
  </div>

  <!-- TH·∫∫ HTML CH√çNH -->
  <div id="ar-card-content">
    
    <!-- HEADER -->
    <div class="card-header">
      <h1>CH√öC M·ª™NG T·ªêT NGHI·ªÜP</h1>
      <h2>T√¢n K·ªπ S∆∞: Ng√¥ T·∫•n T√†i</h2>
    </div>
    
    <!-- SLIDESHOW ·∫¢NH -->
    <div class="slideshow-container">
      <img src="/image/graduation/main1.jpg" class="slide-img active">
      <img src="/image/graduation/main2.jpg" class="slide-img">
      <img src="/image/graduation/main3.jpg" class="slide-img">
      <img src="/image/graduation/main4.jpg" class="slide-img">
    </div>

    <!-- MARQUEE (CH·ªÆ CH·∫†Y) -->
    <div class="marquee-wrapper">
      <div class="marquee-content">
        <span>üéâ Ch√∫c m·ª´ng T√¢n K·ªπ S∆∞ ƒêi·ªán Ng√¥ T·∫•n T√†i!</span>
        <span>üéì Ch√∫c b·∫°n lu√¥n v·ªØng b∆∞·ªõc v√† th√†nh c√¥ng tr√™n con ƒë∆∞·ªùng s·ª± nghi·ªáp!</span>
        <span>üöÄ The Future is Yours to Create!</span>
      </div>
    </div>
  
  </div>

  <audio id="bg-music" src="/music/music.mp3" loop></audio>

  <!-- D·∫£i film b√™n d∆∞·ªõi -->
  <div id="filmstrip-container">
     <p style="color: white; font-size: 10px; opacity: 0.7;">ƒêang ph√°t nh·∫°c...</p>
  </div>

  <!-- A-FRAME SCENE -->
  <a-scene 
    app-manager
    mindar-image="imageTargetSrc: /ar-card/target.mind; uiScanning: no; uiLoading: no;" 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights: true" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false">

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- TARGET -->
    <a-entity mindar-image-target="targetIndex: 0">
      
      <!-- 1. ƒêI·ªÇM NEO CHO TH·∫∫ HTML -->
      <!-- ƒê·∫∑t position="0.75 0 0" ƒë·ªÉ th·∫ª n·∫±m l·ªách b√™n ph·∫£i m·ªôt ch√∫t so v·ªõi ·∫£nh th·∫≠t -->
      <a-entity 
        id="html-anchor" 
        position="0.75 0 0" 
        html-follower="target: #ar-card-content">
      </a-entity>

      <!-- 2. HI·ªÜU ·ª®NG 3D -->
      <a-plane position="0 0 0" width="1" height="1.4" color="white" opacity="0.05"></a-plane>
      <a-ring color="#00C6FF" radius-inner="0.55" radius-outer="0.56" position="0 0 0"
        animation="property: rotation; to: 0 0 360; dur: 10000; loop: true; easing: linear">
      </a-ring>

    </a-entity>
  </a-scene>
</body>
</html>