<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>AR Graduation Album</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

  <style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; }
    #scanning-overlay { display: flex; align-items: center; justify-content: center; position: fixed; left: 0; right: 0; top: 0; bottom: 0; background: transparent; z-index: 2; pointer-events: none; }
    .scan-text { color: white; font-weight: bold; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 20px; }
    .mindar-ui-scanning #scanning-overlay { display: flex; }
    .mindar-ui-loading #scanning-overlay { display: none; }
  </style>

  <script>
    // --- COMPONENT SLIDESHOW NÂNG CAO (Tự động load ảnh trước) ---
    AFRAME.registerComponent('image-slideshow', {
      schema: {
        sources: {type: 'array', default: []}, // Danh sách đường dẫn ảnh
        interval: {type: 'number', default: 2500}, // Thời gian chuyển ảnh (ms)
      },
      init: function () {
        this.currentIndex = 0;
        this.images = [];
        // Preload (tải trước) tất cả ảnh để tránh bị nháy đen khi chuyển
        this.data.sources.forEach((src, index) => {
          const img = new Image();
          img.src = src;
          this.images.push(img);
          // Set ảnh đầu tiên ngay khi load xong
          if (index === 0) {
            img.onload = () => { this.el.setAttribute('src', src); };
          }
        });

        if (this.images.length > 1) {
          this.startSlideshow();
        }
      },
      startSlideshow: function () {
        this.intervalId = setInterval(() => {
          this.currentIndex = (this.currentIndex + 1) % this.images.length;
          // Cập nhật thuộc tính src của a-image bằng đường dẫn của ảnh tiếp theo
          this.el.setAttribute('src', this.images[this.currentIndex].src);
        }, this.data.interval);
      },
      remove: function () {
        // Dọn dẹp bộ nhớ khi component bị hủy
        if (this.intervalId) clearInterval(this.intervalId);
      }
    });
  </script>
</head>

<body>
  <div id="scanning-overlay" style="display:none">
      <div class="scan-text">HÃY SOI VÀO TẤM THẺ...</div>
  </div>

  <a-scene 
    mindar-image="imageTargetSrc: /ar-card/target.mind; filterMinCF:0.0001; filterBeta: 0.001; uiScanning: no;" 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights"
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false">

    <a-assets>
      <img id="cardBg" src="/ar-card/tag.png" />
      <img id="placeholder" src="/ar-card/tag.png"> 
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">

      <a-image src="#cardBg" position="0 0 0" height="1.05" width="1.05" opacity="0.8"></a-image>


      <a-entity position="0 0.4 0.01">
        <a-text value="CHUC MUNG TAN KY SU!" align="center" width="3" color="#FFD700" font="exo2bold" position="0 0.08 0"></a-text>
        <a-text value="Tung canh bay xa, vung vang tuong lai!" align="center" width="2" color="#FFFFFF" font="roboto" position="0 0 0"></a-text>
      </a-entity>


      <a-image 
        src="#placeholder"
        position="0 0.05 0.02" 
        width="0.9" height="0.6"
        image-slideshow="interval: 3000; sources: [
          '/image/graduation/main1.jpg',
          '/image/graduation/main2.jpg',
          '/image/graduation/main3.jpg',
          '/image/graduation/main4.jpg',
          '/image/graduation/main5.jpg',
          '/image/graduation/main6.jpg'
        ]">
      </a-image>


      <a-text value="Thuoc phim ky niem" align="center" width="1.5" color="#CCC" position="0 -0.3 0.01"></a-text>
      
      <a-image 
        src="#placeholder"
        position="0 -0.45 0.02" 
        width="1" height="0.25"
        image-slideshow="interval: 2000; sources: [
          '/image/graduation/kyniem/kn1.jpg',
          '/image/graduation/kyniem/kn2.jpg',
          '/image/graduation/kyniem/kn3.jpg',
          '/image/graduation/kyniem/kn4.jpg'
        ]">
      </a-image>

    </a-entity>
  </a-scene>
</body>
</html>