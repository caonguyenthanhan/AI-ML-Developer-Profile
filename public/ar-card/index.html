<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AR Card - Debug Mode</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>

  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    #error-log {
        position: fixed; top: 0; left: 0; width: 100%; background: rgba(255,0,0,0.8); 
        color: white; padding: 10px; z-index: 9999; display: none; font-size: 12px;
    }
  </style>

  <script>
    // Hàm kiểm tra xem file có tồn tại không trước khi chạy AR
    // Giúp phát hiện lỗi sai đường dẫn ngay lập tức
    async function checkFileExists(url, name) {
        try {
            const response = await fetch(url, { method: 'HEAD' });
            if (!response.ok) throw new Error("404 Not Found");
            console.log(`✅ Đã tìm thấy file ${name}: ${url}`);
        } catch (error) {
            const msg = `❌ LỖI NGHIÊM TRỌNG: Không tìm thấy file ${name}!\nĐường dẫn sai: ${url}`;
            alert(msg); // Hiện thông báo lỗi lên màn hình điện thoại
            document.getElementById('error-log').innerText = msg;
            document.getElementById('error-log').style.display = 'block';
        }
    }

    // Kiểm tra ngay khi load trang
    window.onload = function() {
        // Kiểm tra file target.mind
        checkFileExists('/public/ar-card/target.mind', 'TARGET (target.mind)');
        // Kiểm tra file avatar.glb
        checkFileExists('/public/ar-card/avatar.glb', 'MODEL (avatar.glb)');
    };
  </script>
</head>

<body>
  <div id="error-log"></div>

  <a-scene 
    mindar-image="imageTargetSrc: /public/ar-card/target.mind; filterMinCF:0.0001; filterBeta: 0.001;" 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights"
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false">

    <a-assets>
      <a-asset-item id="avatarModel" src="/public/ar-card/avatar.glb"></a-asset-item>
      <img id="cardBg" src="/public/ar-card/tag.png" />
      <img id="icon-fb" src="/public/ar-card/tag.png" /> 
      <img id="icon-web" src="/public/ar-card/tag.png" />
      <img id="icon-zalo" src="/public/ar-card/tag.png" />
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
      
      <a-plane color="#000" position="0 0 0" height="1" width="1" opacity="0.7"></a-plane>

      <a-gltf-model 
        src="#avatarModel" 
        position="0 -0.4 0.1" 
        scale="0.4 0.4 0.4"
        animation-mixer>
      </a-gltf-model>

      <a-text value="NGO TAN TAI" align="center" position="0 0.4 0.1" width="3" color="#FFD700"></a-text>
      <a-text value="Loading..." align="center" position="0 -0.6 0.1" width="2" color="#FFF"></a-text>

    </a-entity>
  </a-scene>
</body>
</html>