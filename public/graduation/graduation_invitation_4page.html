<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Thiệp Mời Tốt Nghiệp — Tân Cử nhân Ngô Tấn Tài</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/image/graduation/logotruong.png" />
  <link rel="apple-touch-icon" href="/image/graduation/logotruong.png" />

  <!-- Open Graph / Zalo / Twitter -->
  <meta property="og:title" content="Thiệp Mời Lễ Tốt Nghiệp" />
  <meta property="og:description" content="Trân trọng kính mời bạn đến chung vui tại Lễ Tốt Nghiệp." />
  <meta property="og:image" content="/image/graduation/main-preview.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />
  <meta property="og:site_name" content="Graduation Invite" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: "#03204c",
            gold: "#ffd700",
          },
          fontFamily: {
            sans: ["Inter", "ui-sans-serif", "system-ui"],
            serif: ["Playfair Display", "ui-serif"],
          },
        },
      },
    };
  </script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">

  <!-- Icons + Confetti -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // ========= Global setup & constants =========
    const appId = typeof __app_id !== "undefined" ? __app_id : "default-app-id";
    const firebaseConfig = typeof __firebase_config !== "undefined" ? JSON.parse(__firebase_config) : {};
    const initialAuthToken = typeof __initial_auth_token !== "undefined" ? __initial_auth_token : null;
    const APP_ROOT = "/graduation";

    const DEFAULT_INVITE_MESSAGE =
      "Thân gửi bạn, hãy đến chung vui cùng tôi trong buổi lễ trọng đại này. Sự hiện diện của bạn là niềm vinh dự lớn nhất!";

    const ASSETS = {
      GRADUATE_IMAGE: "/image/graduation/main.jpg",
      MAP_IMAGE: "/image/graduation/map.jpg",
      MAN_DEFAULT: "/image/graduation/man.jpg",
      WOMEN_DEFAULT: "/image/graduation/women.jpg",
      LAUREL_WREATH: "/image/nguyet-que.png",
      GOLD_FRAME: "/image/vien-vang.png",
      LOGO: "/image/graduation/logotruong.png",
      BG_VIDEO: "/video/sparkle-background.mp4",
    };

    const INFO_URL = "/data/info.json";
    const GUESTS_URL = "/data/khach.json";

    let db, auth;
    let isAuthReady = false;

    async function setupFirebase() {
      try {
        if (!firebaseConfig || Object.keys(firebaseConfig).length === 0) {
          console.warn("Missing firebaseConfig — sẽ dùng dữ liệu JSON fallback.");
          return false;
        }
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);
        if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken);
        else await signInAnonymously(auth);
        isAuthReady = true;
        return true;
      } catch (e) {
        console.error("Firebase init error:", e);
        return false;
      }
    }

    const infoDocRef = () => doc(db, "artifacts", appId, "public", "data", "info", "event_details");
    const guestsColRef = () => collection(db, "artifacts", appId, "public", "data", "khach");

    async function loadData() {
      let info = null, guests = [];
      const canUseFs = await setupFirebase();
      if (canUseFs && isAuthReady) {
        try {
          const infoSnap = await getDoc(infoDocRef());
          if (infoSnap.exists()) info = infoSnap.data();
          const guestsSnap = await getDocs(guestsColRef());
          guests = guestsSnap.docs.map(d => d.data());
        } catch (e) {
          console.warn("Firestore read failed, fallback JSON...", e);
        }
      }
      try {
        if (!info) {
          const r = await fetch(INFO_URL, { cache: "no-store" });
          if (r.ok) info = await r.json();
        }
        if (!guests?.length) {
          const r = await fetch(GUESTS_URL, { cache: "no-store" });
          if (r.ok) {
            const j = await r.json();
            guests = Array.isArray(j?.guests) ? j.guests : Array.isArray(j) ? j : [];
          }
        }
      } catch (e) {
        console.error("Local JSON load error:", e);
      }
      guests = (guests || []).map(g => ({ ...g, nameEncoded: encodeURIComponent(g.name) }));
      return { info, guests };
    }

    // ========= UI helpers =========
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

    function updateMeta(info, guest) {
      const title = guest
        ? `Thư mời dành cho ${guest.title} ${guest.name}`
        : `Thiệp Mời Lễ Tốt Nghiệp | ${info?.graduateName || "Graduate"}`;
      const desc = guest
        ? `Thiệp mời đặc biệt từ ${info?.graduateName || "Tân cử nhân"} dành cho ${guest.title} ${guest.name}.`
        : `Trân trọng kính mời bạn đến chung vui cùng ${info?.graduateName || "tân cử nhân"}.`;
      const img = guest?.previewImage || info?.previewImage || ASSETS.GRADUATE_IMAGE;
      document.title = title;
      const set = (sel, attr, val) => { const m = $(sel); if (m) m.setAttribute(attr, val); };
      set('meta[property="og:title"]', "content", title);
      set('meta[property="og:description"]', "content", desc);
      set('meta[property="og:image"]', "content", img.startsWith("http") ? img : `${location.origin}${img}`);
      set('meta[name="twitter:card"]', "content", "summary_large_image");
      set('meta[property="og:image:width"]', "content", "1200");
      set('meta[property="og:image:height"]', "content", "630");
    }

    function goldConfettiBurst() {
      confetti({
        particleCount: 140,
        spread: 70,
        origin: { y: 0.6 },
        colors: ["#FFD700", "#FFF3B0", "#FDE047"],
      });
    }

    function toast(msg) {
      const t = document.createElement("div");
      t.className = "fixed bottom-6 left-1/2 -translate-x-1/2 bg-black/70 text-white px-4 py-2 rounded-full text-sm z-[120] shadow";
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1800);
    }

    // ========= Slider (4 pages) =========
    let currentSlide = 0;
    const totalSlides = 4;

    function goTo(i) {
      currentSlide = Math.max(0, Math.min(totalSlides - 1, i));
      const track = $("#track");
      track?.style.setProperty("--idx", currentSlide);
      // update dots
      $$(".dot").forEach((d, idx) => {
        if (idx === currentSlide) d.classList.add("bg-gold", "scale-110");
        else d.classList.remove("bg-gold", "scale-110");
      });
    }
    function next() { goTo(currentSlide + 1); }
    function prev() { goTo(currentSlide - 1); }

    // ========= Music control =========
    function setupMusic(info) {
      const audio = $("#bgm");
      const btn = $("#musicBtn");
      if (!audio || !btn) return;
      if (info?.music) audio.src = info.music;

      let playing = false;
      const render = () => btn.innerHTML = playing
        ? '<i data-lucide="volume-2" class="w-6 h-6"></i>'
        : '<i data-lucide="volume-x" class="w-6 h-6"></i>';

      const tryPlay = () => audio.play().then(() => {
        playing = true; render(); lucide.createIcons();
      }).catch(() => { playing = false; render(); lucide.createIcons(); });

      btn.addEventListener("click", () => {
        if (!playing) tryPlay(); else { audio.pause(); playing = false; render(); lucide.createIcons(); }
      });

      // Autoplay attempt
      setTimeout(() => tryPlay(), 600);
      // first click fallback
      document.addEventListener("click", () => { if (!playing) tryPlay(); }, { once: true });
    }

    // ========= Guest search & routing =========
    function normalize(s) {
      return (s || "")
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .toLowerCase().trim();
    }

    function bindSearch(guests) {
      $$("#guestSearchForm").forEach(form => {
        const input = form.querySelector("input[name='guest']");
        form.addEventListener("submit", e => {
          e.preventDefault();
          const q = normalize(input.value);
          if (!q) { input.focus(); return; }
          let target = guests.find(g => normalize(g.name) === q) || guests.find(g => normalize(g.name).includes(q));
          if (target) {
            history.pushState({}, "", `${APP_ROOT}/${encodeURIComponent(target.name)}`);
            // re-render page 4 in personalized mode
            renderPage4(window.__INFO__, target);
            updateMeta(window.__INFO__, target);
            goldConfettiBurst();
            goTo(3);
          } else {
            input.classList.add("ring-2", "ring-red-500"); setTimeout(() => input.classList.remove("ring-2", "ring-red-500"), 1200);
          }
        });
      });
    }

    // ========= Render pages =========
    function renderPage1(info) {
      const el = $("#page1");
      el.innerHTML = `
        <div class="absolute inset-0 -z-10">
          <video autoplay loop muted playsinline class="w-full h-full object-cover opacity-80">
            <source src="${ASSETS.BG_VIDEO}" type="video/mp4">
          </video>
          <div class="absolute inset-0 bg-gradient-to-b from-black/40 to-navy/70"></div>
        </div>

        <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
          <img src="${ASSETS.LOGO}" alt="Logo" class="opacity-10 w-48 h-48">
        </div>

        <div class="text-center text-white">
          <p class="tracking-[0.35em] text-gold font-semibold">THƯ MỜI</p>
          <h1 class="mt-3 font-serif font-black text-5xl md:text-6xl">
            LỄ TỐT NGHIỆP
          </h1>
          <p class="mt-4 text-lg">Trân trọng kính mời</p>
          <div class="mt-6 inline-flex items-center gap-3 bg-white/10 px-5 py-2 rounded-full border border-white/20">
            <span class="text-gold font-bold">TÂN CỬ NHÂN</span>
            <span class="font-serif font-black text-2xl">${info?.graduateName || "Tên Tân Cử Nhân"}</span>
          </div>

          <div class="mt-8">
            <form id="guestSearchForm" class="mx-auto max-w-md flex gap-2">
              <input name="guest" class="flex-1 px-4 py-2 rounded-lg bg-white/90 text-navy placeholder-navy/50 focus:outline-none" placeholder="Nhập tên khách mời của bạn..." />
              <button class="px-4 py-2 rounded-lg bg-gold text-navy font-semibold">Tìm thiệp</button>
            </form>
            <p class="mt-3 text-sm text-white/80">Hoặc bấm mũi tên phải để xem thông tin</p>
          </div>
        </div>
      `;
    }

    function renderPage2(info) {
      const el = $("#page2");
      el.innerHTML = `
        <div class="absolute inset-0 -z-10 bg-gradient-to-br from-white via-white to-yellow-50"></div>
        <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
          <img src="${ASSETS.LOGO}" alt="Logo" class="opacity-10 w-40 h-40">
        </div>

        <div class="w-full max-w-5xl mx-auto px-6">
          <div class="text-center">
            <h2 class="font-serif text-4xl font-black text-navy">Thông Tin Sự Kiện</h2>
            <p class="mt-2 font-semibold text-navy/70">${info?.university || "Tên Trường"}</p>
          </div>

          <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="rounded-xl border border-navy/10 bg-white p-6 text-center shadow-sm">
              <i data-lucide="calendar" class="w-8 h-8 mx-auto text-navy"></i>
              <h3 class="mt-2 font-bold text-navy">Ngày</h3>
              <p class="text-navy/80">${info?.date || "Chưa cập nhật"}</p>
            </div>
            <div class="rounded-xl border border-navy/10 bg-white p-6 text-center shadow-sm">
              <i data-lucide="clock" class="w-8 h-8 mx-auto text-navy"></i>
              <h3 class="mt-2 font-bold text-navy">Giờ</h3>
              <p class="text-navy/80">${info?.time || "Chưa cập nhật"}</p>
            </div>
            <div class="rounded-xl border border-navy/10 bg-white p-6 text-center shadow-sm">
              <i data-lucide="map-pin" class="w-8 h-8 mx-auto text-navy"></i>
              <h3 class="mt-2 font-bold text-navy">Địa điểm</h3>
              <p class="text-navy/80">${info?.venue || "Chưa cập nhật"}</p>
            </div>
          </div>

          <div class="mt-8">
            <a href="${info?.mapLink || '#'}" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-navy text-white hover:bg-navy/90">
              <i data-lucide="map" class="w-5 h-5"></i> Mở Google Maps
            </a>
          </div>

          <div class="mt-6 rounded-xl overflow-hidden border shadow">
            ${info?.mapLink
              ? `<iframe src="${info.mapLink}" width="100%" height="320" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`
              : `<img src="${ASSETS.MAP_IMAGE}" class="w-full h-80 object-cover" alt="Map" />`
            }
          </div>
        </div>
      `;
      lucide.createIcons();
    }

    function renderPage3(info) {
      const el = $("#page3");
      el.innerHTML = `
        <div class="absolute inset-0 -z-10 bg-gradient-to-br from-navy via-navy to-black"></div>
        <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
          <img src="${ASSETS.GOLD_FRAME}" class="opacity-20 w-[90%] max-w-5xl" alt="">
        </div>

        <div class="w-full max-w-5xl mx-auto px-6 text-center text-white">
          <h2 class="font-serif text-4xl font-black text-gold">Tân Cử Nhân</h2>
          <p class="mt-2 text-white/80">${info?.subEventDetails || info?.universityShort || ""}</p>

          <div class="mt-8 flex flex-col md:flex-row items-center justify-center gap-8">
            <div class="relative w-56 h-56 md:w-64 md:h-64">
              <img src="${ASSETS.LAUREL_WREATH}" class="absolute inset-0 w-full h-full object-contain opacity-90" alt="">
              <img src="${info?.graduateImage || ASSETS.GRADUATE_IMAGE}" class="relative left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-40 h-40 md:w-48 md:h-48 object-cover rounded-full ring-4 ring-gold shadow-xl" alt="">
            </div>
            <div class="text-left max-w-lg">
              <h3 class="font-serif text-3xl font-black text-white">${info?.graduateName || "Tên Tân Cử Nhân"}</h3>
              <p class="mt-3 text-white/90 italic">
                "${info?.graduateQuote || "Cảm ơn gia đình, thầy cô và bạn bè đã đồng hành trong chặng đường này."}"
              </p>
              ${info?.contact ? `
                <div class="mt-4 flex items-center gap-4">
                  ${info.contact.phone ? `<a href="tel:${info.contact.phone}" class="hover:text-gold"><i data-lucide="phone" class="w-5 h-5"></i></a>` : ""}
                  ${info.contact.zalo ? `<a href="${info.contact.zalo}" target="_blank" class="hover:text-gold"><i data-lucide="message-square" class="w-5 h-5"></i></a>` : ""}
                  ${info.contact.facebook ? `<a href="${info.contact.facebook}" target="_blank" class="hover:text-gold"><i data-lucide="facebook" class="w-5 h-5"></i></a>` : ""}
                </div>
              ` : ``}
            </div>
          </div>
        </div>
      `;
      lucide.createIcons();
    }

    function renderPage4(info, guest = null) {
      const el = $("#page4");
      const guestName = guest?.name;
      const guestTitle = guest?.title || "";
      const inviteMsg = (guest?.message && guest.message.trim()) ? guest.message : DEFAULT_INVITE_MESSAGE;

      let guestImg = guest?.image ? `/image/graduation/${guest.image}` : null;
      if (!guestImg) guestImg = guest?.gender?.toLowerCase() === "female" ? ASSETS.WOMEN_DEFAULT : ASSETS.MAN_DEFAULT;

      el.innerHTML = `
        <div class="absolute inset-0 -z-10 bg-gradient-to-br from-white to-amber-50"></div>
        <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
          <img src="${ASSETS.LOGO}" class="opacity-10 w-40 h-40" alt="">
        </div>

        <div class="w-full max-w-5xl mx-auto px-6">
          <div class="text-center">
            <h2 class="font-serif text-4xl font-black text-navy">Thiệp Mời Cá Nhân</h2>
            ${guest ? `<p class="mt-2 text-navy/80">Dành cho <span class="font-semibold">${guestTitle} ${guestName}</span></p>` : `<p class="mt-2 text-navy/80">Tìm thiệp mời theo tên của bạn</p>`}
          </div>

          <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="md:col-span-2 rounded-xl border border-navy/10 bg-white p-6 shadow-sm">
              <p class="text-lg font-serif italic text-navy/90">"${inviteMsg}"</p>
              <p class="mt-3 text-sm text-navy/70">— ${info?.graduateName || "Tân cử nhân"}</p>

              <div class="mt-6 flex flex-wrap items-center gap-3">
                ${info?.rsvpLink ? `
                  <a href="${info.rsvpLink}" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-navy text-white hover:bg-navy/90">
                    <i data-lucide="check-circle" class="w-5 h-5"></i> Xác nhận tham dự (RSVP)
                  </a>` : ``
                }
                <a href="${APP_ROOT}" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gold text-navy hover:bg-yellow-400">
                  <i data-lucide="home" class="w-5 h-5"></i> Về trang đầu
                </a>
              </div>
            </div>

            <div class="rounded-xl border border-navy/10 bg-white p-6 text-center shadow-sm">
              <img src="${guestImg}" class="w-20 h-20 rounded-full object-cover mx-auto mb-3 ring-2 ring-navy/10" alt="">
              <p class="font-semibold">${guest ? `${guestTitle} ${guestName}` : "Tìm thiệp theo tên"}</p>
              <form id="guestSearchForm" class="mt-3 flex gap-2">
                <input name="guest" class="flex-1 px-3 py-2 rounded-lg bg-gray-50 border border-navy/10 focus:outline-none" placeholder="Nhập tên khách mời..." />
                <button class="px-3 py-2 rounded-lg bg-gold text-navy font-semibold">Tìm</button>
              </form>
            </div>
          </div>
        </div>
      `;
      lucide.createIcons();
    }

    // ========= Controls & bindings =========
    function bindControls() {
      $("#nextBtn")?.addEventListener("click", next);
      $("#prevBtn")?.addEventListener("click", prev);
      $$(".dot").forEach((d, idx) => d.addEventListener("click", () => goTo(idx)));

      // keyboard
      window.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight") next();
        if (e.key === "ArrowLeft") prev();
      });

      // touch swipe
      let sx = null;
      $("#track").addEventListener("touchstart", e => sx = e.touches[0].clientX, { passive: true });
      $("#track").addEventListener("touchend", e => {
        if (sx == null) return;
        const dx = e.changedTouches[0].clientX - sx;
        if (dx < -40) next();
        if (dx > 40) prev();
        sx = null;
      });
    }

    function mountChrome(info) {
      // music
      setupMusic(info);

      // fireworks on first page load
      setTimeout(() => goldConfettiBurst(), 800);

      // watermark logo overlay (always-on small logo at corner)
      $("#logoOverlay").innerHTML = `
        <div class="pointer-events-none opacity-90">
          <img src="${ASSETS.LOGO}" class="w-10 h-10 md:w-12 md:h-12" alt="">
        </div>
      `;
    }

    // ========= Router (keep /graduation + personalized guest) =========
    function getCurrentGuest(guests) {
      const parts = location.pathname.replace(/\/+$/, "").split("/").filter(Boolean);
      if (parts.length === 2 && parts[0].toLowerCase() === "graduation") {
        const name = decodeURIComponent(parts[1]);
        return guests.find(g => g.name.toLowerCase() === name.toLowerCase()) || null;
      }
      return null;
    }

    async function main() {
      $("#app").classList.remove("hidden");
      $("#loading").classList.add("hidden");

      const { info, guests } = await loadData();
      if (!info) {
        $("#app").innerHTML = `
          <div class="p-8 bg-white rounded-xl shadow max-w-md mx-auto mt-16 border-t-4 border-red-500 text-center">
            <h2 class="text-2xl font-bold text-red-600">Không thể tải dữ liệu</h2>
            <p class="mt-2 text-gray-700">Vui lòng kiểm tra Firestore hoặc file JSON fallback.</p>
            <ul class="mt-3 text-left text-sm text-gray-600 list-disc list-inside">
              <li>/artifacts/{appId}/public/data/info/event_details</li>
              <li>/artifacts/{appId}/public/data/khach</li>
            </ul>
          </div>`;
        return;
      }

      window.__INFO__ = info;

      // Render pages
      renderPage1(info);
      renderPage2(info);
      renderPage3(info);

      const currentGuest = getCurrentGuest(guests);
      renderPage4(info, currentGuest);
      updateMeta(info, currentGuest);

      // Bind search
      bindSearch(guests);

      // Chrome (music, overlay, confetti)
      mountChrome(info);

      // Controls
      bindControls();

      // nav dots
      goTo(0);

      // handle back/forward -> re-render page4 if guest changes
      window.addEventListener("popstate", () => {
        const g = getCurrentGuest(guests);
        renderPage4(info, g);
        updateMeta(info, g);
      });
    }

    // bootstrap
    window.addEventListener("load", main);
  </script>

  <style>
    :root { --idx: 0; }
    /* Horizontal slider track for 4 full-screen slides */
    #track {
      display: grid;
      grid-template-columns: repeat(4, 100vw);
      width: 400vw;
      height: 100vh;
      transform: translateX(calc(-1 * var(--idx, 0) * 100vw));
      transition: transform 500ms ease;
    }
    .slide {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: grid;
      place-items: center;
      padding: 2rem;
    }
    .btn-fab {
      @apply w-12 h-12 rounded-full flex items-center justify-center shadow-lg bg-gold text-navy hover:scale-110 transition;
    }
  </style>
</head>
<body class="min-h-screen font-sans bg-gradient-to-b from-slate-50 to-white">

  <!-- Loading -->
  <div id="loading" class="fixed inset-0 grid place-items-center bg-white z-[200]">
    <div class="text-center">
      <svg class="animate-spin h-10 w-10 text-navy mx-auto" viewBox="0 0 24 24" fill="none">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
      </svg>
      <p class="mt-3 font-semibold text-navy">Đang tải thiệp mời...</p>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="hidden">
    <!-- Track (4 slides) -->
    <div id="track" style="--idx:0">
      <section id="page1" class="slide text-white"></section>
      <section id="page2" class="slide"></section>
      <section id="page3" class="slide"></section>
      <section id="page4" class="slide"></section>
    </div>

    <!-- Controls -->
    <div class="fixed bottom-4 left-4 z-[110] flex items-center gap-2">
      <button id="prevBtn" class="btn-fab" title="Trang trước"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
      <div class="flex items-center gap-2">
        <button class="dot w-2.5 h-2.5 rounded-full bg-black/20"></button>
        <button class="dot w-2.5 h-2.5 rounded-full bg-black/20"></button>
        <button class="dot w-2.5 h-2.5 rounded-full bg-black/20"></button>
        <button class="dot w-2.5 h-2.5 rounded-full bg-black/20"></button>
      </div>
      <button id="nextBtn" class="btn-fab" title="Trang sau"><i data-lucide="chevron-right" class="w-6 h-6"></i></button>
    </div>

    <!-- Music & Celebrate -->
    <div class="fixed bottom-4 right-4 z-[110] flex items-center gap-2">
      <button id="musicBtn" class="btn-fab" title="Nhạc nền"><i data-lucide="volume-x" class="w-6 h-6"></i></button>
      <button id="celebrateBtn" class="btn-fab" title="Chúc mừng!"><i data-lucide="party-popper" class="w-6 h-6"></i></button>
    </div>

    <!-- Logo overlay -->
    <div id="logoOverlay" class="fixed top-4 right-4 z-[110]"></div>

    <!-- Audio -->
    <audio id="bgm" loop></audio>
  </div>

  <script>
    // Small inline script for celebrate button (no Firebase needed)
    document.addEventListener("click", (e) => {
      const btn = e.target.closest("#celebrateBtn");
      if (!btn) return;
      confetti({
        particleCount: 180,
        spread: 100,
        origin: { y: 0.6 },
        colors: ["#FFD700","#FFF3B0","#FDE047","#FACC15"]
      });
    });
    // init icons after static HTML
    window.addEventListener("load", () => { try { lucide.createIcons(); } catch(_){} });
  </script>
</body>
</html>
