<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Lời Mời Tốt Nghiệp Cá Nhân Hóa</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="/image/graduation/logotruong.jpg">
    <link rel="shortcut icon" type="image/jpeg" href="/image/graduation/logotruong.jpg">
    <link rel="apple-touch-icon" href="/image/graduation/logotruong.jpg">
    
    <!-- Meta tags cho Open Graph (Facebook, Zalo) -->
    <meta property="og:title" content="Lời Mời Tham Dự Lễ Tốt Nghiệp">
    <meta property="og:description" content="Trân trọng kính mời bạn đến tham dự buổi lễ tốt nghiệp của chúng tôi. Sự hiện diện của bạn là niềm vinh dự lớn nhất!">
    <meta property="og:image" content="https://hethongthongminh.id.vn/image/graduation/main-preview.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:site_name" content="Lễ Tốt Nghiệp">
    
    <!-- Meta tags cho Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Lời Mời Tham Dự Lễ Tốt Nghiệp">
    <meta name="twitter:description" content="Trân trọng kính mời bạn đến tham dự buổi lễ tốt nghiệp của chúng tôi.">
    <meta name="twitter:image" content="/image/graduation/main-preview.jpg">
    
    <!-- Meta tags đặc biệt cho Zalo -->
    <meta property="zalo:title" content="Lời Mời Tham Dự Lễ Tốt Nghiệp">
    <meta property="zalo:description" content="Trân trọng kính mời bạn đến tham dự buổi lễ tốt nghiệp của chúng tôi. Sự hiện diện của bạn là niềm vinh dự lớn nhất!">
    <meta property="zalo:image" content="/image/graduation/main-preview.jpg">
    
    <!-- Meta tags chung -->
    <meta name="description" content="Lời mời tham dự lễ tốt nghiệp - Sự hiện diện của bạn là niềm vinh dự lớn nhất của chúng tôi!">
    <meta name="keywords" content="lễ tốt nghiệp, graduation, lời mời, thiệp mời">
    <meta name="author" content="Graduation Invitation">
    <!-- Tailwind CSS (build bằng CLI) -->
<link href="/assets/css/tw.css" rel="stylesheet">
    <!-- Tải thư viện icon Lucide-React -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Tải thư viện confetti cho hiệu ứng chúc mừng -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <!-- Firebase compat SDKs -->
 <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <style>
        /* CSS tuỳ chỉnh để thêm hiệu ứng lấp lánh và kiểu thiệp mời */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;600;700&display=swap');
        
        body {
            background-color: #eef2ff; /* Nền xanh nhạt bên ngoài */
        }
        
        /* Hiệu ứng lấp lánh (dùng cho nền cột trái) */
        .sparkle-background {
            background-color: #03204c;
            background-image: 
                radial-gradient(circle at top right, rgba(255, 215, 0, 0.1) 1px, transparent 0), 
                radial-gradient(circle at bottom left, rgba(255, 215, 0, 0.1) 1px, transparent 0);
            background-size: 20px 20px;
        }

        /* Viền vàng lấp lánh cho ảnh */
        .golden-border {
            border: 4px solid transparent;
            box-shadow: 0 0 15px 5px rgba(255, 215, 0, 0.8), 0 0 5px 2px rgba(255, 215, 0, 0.6);
        }

        /* Thiệp mời đặc biệt (dành cho Cha, Mẹ, Thầy Cô) */
        .special-card {
            background: linear-gradient(135deg, #05376e, #03204c);
            box-shadow: 0 10px 30px rgba(3, 32, 76, 0.8);
            border: 3px solid #ffd700;
        }

        /* Viền thiệp chính (cột phải) */
        .invitation-frame {
            border: 2px solid #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
        }
        .gold-frame-bg {
            background-image: url('/image/vien-vang.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 100% 100%;
        }
        /* Hiệu ứng ánh sáng mới */
        .gold-shine {
            color: #ffd700;
            animation: goldShine 3.2s ease-in-out infinite;
            text-shadow: 0 0 6px rgba(255,215,0,0.6), 0 0 2px rgba(255,215,0,0.4);
        }
        @keyframes goldShine {
            0%, 100% {
                text-shadow: 0 0 6px rgba(255,215,0,0.6), 0 0 2px rgba(255,215,0,0.4);
                transform: scale(1);
            }
            50% {
                text-shadow: 0 0 12px rgba(255,215,0,0.8), 0 0 4px rgba(255,215,0,0.6);
                transform: scale(1.01);
            }
        }
        .soft-glow {
            position: relative;
        }
        .soft-glow::before {
            content: "";
            position: absolute;
            inset: -10%;
            background: radial-gradient(circle at 50% 30%, rgba(255, 215, 0, 0.12), transparent 60%);
            filter: blur(10px);
            z-index: 0;
            pointer-events: none;
        }
        .soft-glow > * {
            position: relative;
            z-index: 1;
        }

        /* HIỆU ỨNG ẢNH SINH ĐỘNG */
        .animated-image {
            animation: float 4s ease-in-out infinite;
        }
        @keyframes float {
            0% {
                transform: translatey(0px);
            }
            50% {
                transform: translatey(-10px);
            }
            100% {
                transform: translatey(0px);
            }
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Container chính để render nội dung -->
    <div id="app" class="flex flex-col items-center p-4 md:p-8">
        <!-- Nội dung sẽ được render bởi JavaScript -->
        <div class="text-center p-8">Đang tải...</div>
    </div>
    
    <!-- Container cho các nút điều khiển -->
    <div id="controls" class="fixed bottom-4 right-4 z-50 space-x-2"></div>
    <!-- Audio player cho nhạc nền -->
    <audio id="background-music" loop></audio>

 <script src="/assets/js/app.js"></script>
                        <div class="absolute inset-0 bg-white/40 backdrop-blur-sm z-[2]"></div>
                        <img src="/image/graduation/logotruong.png" alt="Logo Trường" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-24 md:w-28 opacity-90 z-[1] pointer-events-none">
                        <div class="relative z-[10] flex-1 flex flex-col">
                            <div class="text-center">
                            <p class="text-sm font-semibold tracking-widest text-gray-500">${info.university || 'Tên trường'}</p>
                            <h1 class="text-4xl font-serif font-black text-navy mt-2">LỄ TỐT NGHIỆP</h1>
                            <p class="text-base font-bold text-gray-700 mt-2">${info.subEventDetails || info.universityShort || 'UEH'} - ${info.date ? `Ngày ${info.date}` : 'Thông tin phụ'}</p>
                            <div class="w-full h-px bg-gray-300 my-6"></div>
                        </div>

                        <div class="space-y-6 mb-8">
                            <div class="flex flex-col md:flex-row justify-center gap-8 mb-12">
                            <div class="bg-purple-50 p-6 rounded-xl">
                                <i data-lucide="calendar" class="w-8 h-8 text-purple-600 mb-3 mx-auto"></i>
                                <h3 class="font-bold text-gray-700">NGÀY</h3>
                                <p class="text-gray-600">${info.date || 'Chưa cập nhật'}</p>
                            </div>
                            
                            <div class="bg-indigo-50 p-6 rounded-xl">
                                <i data-lucide="clock" class="w-8 h-8 text-indigo-600 mb-3 mx-auto"></i>
                                <h3 class="font-bold text-gray-700">THỜI GIAN</h3>
                                <p class="text-gray-600">${info.time || 'Chưa cập nhật'}</p>
                            </div>
                            
                            <div class="bg-blue-50 p-6 rounded-xl">
                                <i data-lucide="map-pin" class="w-8 h-8 text-blue-600 mb-3 mx-auto"></i>
                                <h3 class="font-bold text-gray-700">ĐỊA ĐIỂM</h3>
                                <p class="text-gray-600">${info.venue || 'Chưa cập nhật'}</p>
                            </div>
                        </div>
                            <div>
                                <h3 class="text-sm font-black tracking-widest text-navy uppercase mb-1">ĐỊA ĐIỂM</h3>
                                <a href="${info.mapLink || '#'}" target="_blank" class="block group text-navy hover:text-gold transition-colors duration-200">
                                    <p class="text-lg font-bold flex items-center">
                                        ${info.venue || 'Chưa cập nhật'}
                                        <i data-lucide="map-pin" class="w-4 h-4 ml-2 text-navy group-hover:text-gold"></i>
                                    </p>
                                    <p class="text-sm text-gray-600 group-hover:text-gray-800">${info.address || 'Chưa cập nhật địa chỉ'}</p>
                                    <p class="text-xs text-blue-500 group-hover:underline mt-1">Xem trên Google Maps</p>
                                </a>
                            </div>
                        </div>

                        <div class="flex flex-col items-center p-4 bg-gray-50 rounded-lg border border-gray-200 mt-auto">
                            <!-- Vòng ảnh khách mời trong cột phải KHÔNG có vòng nguyệt quế theo thiết kế ban đầu -->
                            <img src="${guestImg}" alt="Ảnh Khách Mời" onerror="this.onerror=null;this.src='${guest.gender && guest.gender.toLowerCase() === 'female' ? ASSETS.WOMEN_DEFAULT : ASSETS.MAN_DEFAULT}';" class="w-16 h-16 rounded-full object-cover mb-3 border-2 border-navy animated-image">
                            <p class="text-lg font-serif italic text-gray-700 text-center mb-4">
                                "${inviteMsg}"
                            </p>
                            <p class="text-sm font-semibold text-navy">Trân trọng từ người tốt nghiệp, ${info.graduateName} </p>
                        </div>
                        
                        <div class="text-center mt-6 pt-4 border-t border-gray-200">
                            <h3 class="text-lg font-bold text-navy">TRÂN TRỌNG KÍNH MỜI</h3>
                            <p class="text-2xl font-serif font-extrabold text-navy mt-1">${guestTitle} ${guestName}</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // --- 6. HÀM XỬ LÝ LỖI DỮ LIỆU ---
        function renderDataError(message) {
            return `
                <div class="text-center p-12 bg-white rounded-xl shadow-lg mt-12 max-w-md border-t-8 border-red-500">
                    <h1 class="text-3xl font-bold text-red-600 mb-4">Lỗi Dữ Liệu</h1>
                    <p class="text-gray-600">${message}</p>
                    <p class="text-sm text-gray-500 mt-2">Vui lòng đảm bảo Firebase đã được thiết lập và các documents/collection sau đã được tạo:</p>
                    <ul class="text-left text-xs text-gray-500 list-disc list-inside mt-2 mx-auto max-w-xs">
                        <li>/artifacts/{appId}/public/data/info/event_details (Document)</li>
                        <li>/artifacts/{appId}/public/data/khach (Collection)</li>
                    </ul>
                </div>
            `;
        }


        function renderLoading() {
            document.getElementById('app').innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-screen w-full">
                    <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-navy" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-4 text-navy font-semibold">Đang tải dữ liệu thiệp mời...</p>
                </div>
            `;
        }
        
        // Helper: Gắn sự kiện submit cho form tìm thiệp mời khách mời
        function attachGuestForm(guests) {
            const forms = Array.from(document.querySelectorAll('form#guestSearchForm'));
            if (!forms.length) return;
        
            const normalize = (s) => (s || '')
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .toLowerCase()
                .trim();
        
            forms.forEach((form) => {
                const input = form.querySelector('input#guestNameInput');
                if (!input) return;
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const query = normalize(input.value);
                    if (!query) { input.focus(); return; }
                    let target = (guests || []).find(g => normalize(g.name) === query);
                    if (!target) {
                        target = (guests || []).find(g => normalize(g.name).includes(query));
                    }
                    if (target) {
                        history.pushState({}, '', `${APP_ROOT}/${encodeURIComponent(target.name)}`);
                        router();
                    } else {
                        input.classList.add('ring-2', 'ring-red-500');
                        setTimeout(() => input.classList.remove('ring-2', 'ring-red-500'), 1200);
                    }
                });
            });
        }

        // --- 5. CÁC HÀM TIỆN ÍCH MỚI ---

        // Hàm cập nhật Meta Tags
        // Hàm cập nhật Meta Tags (ĐÃ SỬA LỖI)
        const APP_ROOT = "/graduation";
        
        function updateMetaTags(info, guest = null) {
            const defaultTitle = `Lời Mời Lễ Tốt Nghiệp | ${info.graduateName}`;
            const defaultDesc = `Trân trọng kính mời bạn đến chung vui cùng ${info.graduateName} trong buổi lễ tốt nghiệp.`;
            // Quan trọng: Đảm bảo ảnh xem trước của bạn có kích thước 1200x630 pixels
            const defaultImage = `${window.location.origin}${info.previewImage || ASSETS.GRADUATE_IMAGE}`;

            let title, description, image;

            if (guest) {
                title = `Thân mời ${guest.title} ${guest.name}`;
                description = `Thiệp mời đặc biệt dành cho ${guest.title} ${guest.name} từ ${info.graduateName}.`;
                image = `${window.location.origin}${guest.previewImage || info.previewImage || ASSETS.GRADUATE_IMAGE}`;
            } else {
                title = defaultTitle;
                description = defaultDesc;
                image = defaultImage;
            }

            document.title = title;
            document.querySelector('meta[property="og:title"]').setAttribute('content', title);
            document.querySelector('meta[property="og:description"]').setAttribute('content', description);
            document.querySelector('meta[property="og:image"]').setAttribute('content', image);
            document.querySelector('meta[name="twitter:card"]').setAttribute('content', 'summary_large_image');
            
            // === PHẦN THÊM MỚI QUAN TRỌNG ===
            // Thêm thẻ meta cho chiều rộng
            let ogWidth = document.querySelector('meta[property="og:image:width"]');
            if (!ogWidth) {
                ogWidth = document.createElement('meta');
                ogWidth.setAttribute('property', 'og:image:width');
                document.head.appendChild(ogWidth);
            }
            ogWidth.setAttribute('content', '1200'); // Kích thước khuyến nghị

            // Thêm thẻ meta cho chiều cao
            let ogHeight = document.querySelector('meta[property="og:image:height"]');
            if (!ogHeight) {
                ogHeight = document.createElement('meta');
                ogHeight.setAttribute('property', 'og:image:height');
                document.head.appendChild(ogHeight);
            }
            ogHeight.setAttribute('content', '630'); // Kích thước khuyến nghị
            // === KẾT THÚC PHẦN THÊM MỚI ===
        }


        // Hàm điều khiển hiệu ứng chúc mừng
        // Biến toàn cục để theo dõi hiệu ứng hiện tại
        let currentEffectIndex = 0;
        
        function triggerCelebration() {
            const effects = [
                // Hiệu ứng 1: Confetti truyền thống
                () => {
                    const duration = 5 * 1000;
                    const animationEnd = Date.now() + duration;
                    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 100 };

                    function randomInRange(min, max) {
                        return Math.random() * (max - min) + min;
                    }

                    const interval = setInterval(function() {
                        const timeLeft = animationEnd - Date.now();
                        if (timeLeft <= 0) return clearInterval(interval);

                        const particleCount = 50 * (timeLeft / duration);
                        confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
                        confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
                    }, 250);

                    setTimeout(() => confetti({
                        particleCount: 150,
                        spread: 180,
                        origin: { y: 0.6 }
                    }), 500);
                },
                
                // Hiệu ứng 2: Bóng bay bay lên
                () => {
                    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                    for (let i = 0; i < 10; i++) {
                        setTimeout(() => {
                            confetti({
                                particleCount: 20,
                                angle: 90,
                                spread: 45,
                                origin: { x: Math.random(), y: 1.2 },
                                colors: colors,
                                shapes: ['circle'],
                                scalar: 1.2,
                                gravity: -0.5,
                                drift: Math.random() - 0.5
                            });
                        }, i * 200);
                    }
                },
                
                // Hiệu ứng 3: Kim tuyến rơi từ trên
                () => {
                    const duration = 4 * 1000;
                    const animationEnd = Date.now() + duration;
                    
                    const interval = setInterval(function() {
                        const timeLeft = animationEnd - Date.now();
                        if (timeLeft <= 0) return clearInterval(interval);
                        
                        confetti({
                            particleCount: 3,
                            angle: 90,
                            spread: 0,
                            origin: { x: Math.random(), y: -0.1 },
                            colors: ['#FFD700', '#FFA500', '#FF6347'],
                            shapes: ['line'],
                            scalar: 2,
                            gravity: 0.8,
                            ticks: 300
                        });
                    }, 100);
                },
                
                // Hiệu ứng 4: Pháo hoa nổ tung
                () => {
                    const firework = (x, y) => {
                        confetti({
                            particleCount: 100,
                            spread: 360,
                            origin: { x, y },
                            colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'],
                            startVelocity: 45,
                            scalar: 1.5
                        });
                    };
                    
                    // Nhiều pháo hoa nổ liên tiếp
                    setTimeout(() => firework(0.2, 0.3), 0);
                    setTimeout(() => firework(0.8, 0.4), 300);
                    setTimeout(() => firework(0.5, 0.2), 600);
                    setTimeout(() => firework(0.3, 0.6), 900);
                    setTimeout(() => firework(0.7, 0.7), 1200);
                }
            ];
            
            // Chạy hiệu ứng hiện tại
            effects[currentEffectIndex]();
            
            // Chuyển sang hiệu ứng tiếp theo
            currentEffectIndex = (currentEffectIndex + 1) % effects.length;
        }

        // Hàm render các nút điều khiển
        function renderControls(info) {
            const controlsContainer = document.getElementById('controls');
            if (!controlsContainer) return;
            
            let controlsHtml = `
                <button id="celebrateBtn" title="Chúc mừng!" class="bg-gold text-navy w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
                    <i data-lucide="party-popper" class="w-6 h-6"></i>
                </button>
            `;
            
            if (info.music) {
                controlsHtml += `
                    <button id="musicBtn" title="Tắt/Mở nhạc" class="bg-gold text-navy w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
                        <i data-lucide="volume-2" class="w-6 h-6"></i>
                    </button>
                `;
            }

            controlsContainer.innerHTML = controlsHtml;
            lucide.createIcons();

            // Gắn sự kiện cho nút celebration
            document.getElementById('celebrateBtn')?.addEventListener('click', triggerCelebration);

            if (info.music) {
                const musicPlayer = document.getElementById('background-music');
                const musicBtn = document.getElementById('musicBtn');
                musicPlayer.src = info.music;

                // Bắt đầu với trạng thái đang phát (true)
                let isPlaying = true;
                
                const toggleMusic = () => {
                    if (isPlaying) {
                        musicPlayer.pause();
                        musicBtn.innerHTML = '<i data-lucide="volume-x" class="w-6 h-6"></i>';
                    } else {
                        musicPlayer.play().catch(e => console.log("Autoplay bị chặn, cần tương tác của người dùng."));
                        musicBtn.innerHTML = '<i data-lucide="volume-2" class="w-6 h-6"></i>';
                    }
                    isPlaying = !isPlaying;
                    lucide.createIcons();
                };

                musicBtn.addEventListener('click', toggleMusic);
                
                // Tự động phát nhạc và hiệu ứng khi tải trang
                setTimeout(() => {
                    // Tự động phát nhạc
                    musicPlayer.play().catch(e => {
                        console.log("Autoplay bị chặn, cần tương tác của người dùng.");
                        // Nếu autoplay bị chặn, đặt trạng thái là không phát
                        isPlaying = false;
                        musicBtn.innerHTML = '<i data-lucide="volume-x" class="w-6 h-6"></i>';
                        lucide.createIcons();
                    });
                    
                    // Tự động chạy hiệu ứng celebration
                    triggerCelebration();
                }, 1000); // Delay 1 giây để trang load xong
                
                // Thử autoplay khi có tương tác đầu tiên (fallback)
                document.body.addEventListener('click', () => {
                    if (!isPlaying && musicPlayer.paused) {
                        musicPlayer.play().catch(() => {});
                        isPlaying = true;
                        musicBtn.innerHTML = '<i data-lucide="volume-2" class="w-6 h-6"></i>';
                        lucide.createIcons();
                    }
                }, { once: true });
            } else {
                // Nếu không có nhạc, vẫn tự động chạy hiệu ứng
                setTimeout(() => {
                    triggerCelebration();
                }, 1000);
            }
        }

        // --- 7. HÀM ĐỊNH TUYẾN (ROUTER) ---

        async function router() {
            renderLoading();
            const { info, guests } = await initializeData();

            const path = window.location.pathname.replace(/\/+$/, '');
            const pathParts = path.split('/').filter(part => part.length > 0);

            let contentHtml = '';

            // Kiểm tra chung về kết nối Firebase và dữ liệu info
            if (!info) {
                document.getElementById('app').innerHTML = renderDataError('Không thể tải dữ liệu sự kiện từ Firestore.');
                return;
            }

            if (pathParts.length === 1 && pathParts[0].toLowerCase() === 'graduation') {
                // Trang chủ /graduation
                contentHtml = renderMainPage(info, guests);
            } else if (pathParts.length === 2 && pathParts[0].toLowerCase() === 'graduation') {
                // Trang khách mời cá nhân /graduation/{Tên Khách Mời}
                const guestNameEncoded = pathParts[1];
                const guestName = decodeURIComponent(guestNameEncoded);
                const guest = guests.find(g => g.name.toLowerCase() === guestName.toLowerCase());

                if (guest) {
                    contentHtml = renderGuestHtml(info, guest);
                } else {
                    // 404 cho khách mời không tìm thấy
                    contentHtml = `
                        <div class="text-center p-12 bg-white rounded-xl shadow-lg mt-12 max-w-md border-t-8 border-red-500">
                            <h1 class="text-3xl font-bold text-red-600 mb-4">Lỗi 404 - Không tìm thấy</h1>
                            <p class="text-gray-600">Rất tiếc, không tìm thấy thiệp mời cho khách mời "${guestName}".</p>
                            <a href="${APP_ROOT}" class="mt-6 inline-block text-navy font-semibold hover:underline">Quay về trang chủ</a>
                        </div>
                    `;
                }
            } else {
                // 404 chung
                contentHtml = `
                    <div class="p-8 text-center max-w-2xl mx-auto bg-white rounded-xl shadow-xl mt-12 border-t-8 border-red-500">
                        <h1 class="text-4xl font-black text-red-500 mb-4">Lỗi Đường Dẫn</h1>
                        <p class="text-xl text-gray-700 mb-6">Vui lòng truy cập đường dẫn chính:</p>
                        <a href="${APP_ROOT}" class="mt-6 inline-block text-white px-6 py-3 bg-navy rounded-full hover:bg-navy/80 font-semibold">Đi đến ${APP_ROOT}</a>
                    </div>
                `;
            }

            // Render nội dung, meta tags và các nút điều khiển
            document.getElementById('app').innerHTML = contentHtml;
            
            // Cập nhật meta tags dựa trên trang hiện tại
            const currentGuest = pathParts.length === 2 && pathParts[0].toLowerCase() === 'graduation' 
                ? guests.find(g => g.name.toLowerCase() === decodeURIComponent(pathParts[1]).toLowerCase()) 
                : null;
            updateMetaTags(info, currentGuest);
            
            // Render các nút điều khiển
            renderControls(info);
            
            attachGuestForm(guests);
            lucide.createIcons();
        }

        // Khởi tạo router khi tải trang và khi điều hướng lịch sử
        window.addEventListener('load', router);
        window.addEventListener('popstate', router);
    </script>
</body>
</html>
